<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpeg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpeg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpeg">
  <link rel="mask-icon" href="/images/avatar.jpeg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"forgetall.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言最近给自己挖了几个坑，准备填一下。现在来填一下第一个坑：图片模糊。关于图片模糊的方法有很多，比如：Open CV 的各种图片处理、Android 支持的高性能密集型任务执行框架 RenderScript、Java 或者 C&#x2F;C++ 的算法实现图片模糊处理。本篇文章将包含以下内容：  RenderScript 简介与图片模糊的实现 Java &#x2F; C++ 算法实现图片模糊处理 一个简单的动态模糊实">
<meta property="og:type" content="article">
<meta property="og:title" content="记录三种实现图片模糊的方法">
<meta property="og:url" content="https://forgetall.github.io/2017/10/18/%E8%AE%B0%E5%BD%95%E4%B8%89%E7%A7%8D%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%E7%9A%84%E6%96%B9%E6%B3%95/index.html">
<meta property="og:site_name" content="LJ的Blog">
<meta property="og:description" content="前言最近给自己挖了几个坑，准备填一下。现在来填一下第一个坑：图片模糊。关于图片模糊的方法有很多，比如：Open CV 的各种图片处理、Android 支持的高性能密集型任务执行框架 RenderScript、Java 或者 C&#x2F;C++ 的算法实现图片模糊处理。本篇文章将包含以下内容：  RenderScript 简介与图片模糊的实现 Java &#x2F; C++ 算法实现图片模糊处理 一个简单的动态模糊实">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1976147-811795afcd68bbca.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1976147-9bfb94c39bde175a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1976147-22975722f452a427.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1976147-02ea7e2396c60508.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="article:published_time" content="2017-10-18T10:16:50.000Z">
<meta property="article:modified_time" content="2018-05-30T02:35:43.000Z">
<meta property="article:author" content="LJ">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="JNI">
<meta property="article:tag" content="算法">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1976147-811795afcd68bbca.gif?imageMogr2/auto-orient/strip">

<link rel="canonical" href="https://forgetall.github.io/2017/10/18/%E8%AE%B0%E5%BD%95%E4%B8%89%E7%A7%8D%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%E7%9A%84%E6%96%B9%E6%B3%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>记录三种实现图片模糊的方法 | LJ的Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">LJ的Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">学海无涯苦做舟</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://forgetall.github.io/2017/10/18/%E8%AE%B0%E5%BD%95%E4%B8%89%E7%A7%8D%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%E7%9A%84%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="LJ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJ的Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          记录三种实现图片模糊的方法
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-10-18 18:16:50" itemprop="dateCreated datePublished" datetime="2017-10-18T18:16:50+08:00">2017-10-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-05-30 10:35:43" itemprop="dateModified" datetime="2018-05-30T10:35:43+08:00">2018-05-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近给自己挖了几个坑，准备填一下。现在来填一下第一个坑：图片模糊。关于图片模糊的方法有很多，比如：Open CV 的各种图片处理、Android 支持的高性能密集型任务执行框架 RenderScript、Java 或者 C/C++ 的算法实现图片模糊处理。本篇文章将包含以下内容：</p>
<ul>
<li>RenderScript 简介与图片模糊的实现</li>
<li>Java / C++ 算法实现图片模糊处理</li>
<li>一个简单的动态模糊实现</li>
<li>总结</li>
</ul>
<p>至于 Open CV 我以前的一些文有些简单的介绍，如果只是想模糊图片就引入整个的 Open CV 个人感觉还是有点“杀鸡用牛刀”的感觉。对了，关于算法实现什么的……我只是个代码收集者，并非我自己实现的。</p>
<span id="more"></span>

<p>开始之前先放个图，做成什么样心里有点x数</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1976147-811795afcd68bbca.gif?imageMogr2/auto-orient/strip" alt="动态模糊.gif"></p>
<p>如果你看过我同学的那篇<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/49c07c0627aa">Android：简单靠谱的动态高斯模糊效果
</a>你一定会发现我这个布局跟他的有那么一些相似，哇哈哈哈哈哈，你猜对了，我去他项目里复制的。当然了，实现方式不一样，他是用的 RecyclerView 实现的，我这里就自己复写了 Activity 的 onTouch 实现的动态模糊。</p>
<h2 id="RenderScript"><a href="#RenderScript" class="headerlink" title="RenderScript"></a>RenderScript</h2><p>首先简单的介绍一下 RenderScript 这里是我读文档的翻译……又到了展现真正的辣鸡英语水平的时候了……</p>
<p>RenderScript 是 Android 上的高性能计算密集型任务的框架。虽然串行工作也能受益，但是RenderScript 主要面向并行数据计算。RenderScript 运行时可以跨越设备上可用的处理器如多核CPU和GPU进行并行工作。这让你可以专注于算法，而不是调度工作。RenderScript 对于应用进行图像处理，计算摄影或者计算机视觉等方面特别有用。<br>要开始使用RenderScript，有两个主要概念应该要理解：</p>
<ul>
<li><p>语言本身是为了编写高性能计算代码产生的 C99 衍生语言。<a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/renderscript/compute.html#writing-an-rs-kernel">这篇文章</a>描述了如何使用它去编写一个计算内核。</p>
</li>
<li><p>控制 API 是用来管理 RenderScript 资源的生命周期和控制内核运行的。这套API有三套语言实现：Java，Android NDK 的 C++ 和 C99 派生的内核语言本身。</p>
</li>
</ul>
<p>恩，BB这么多，我们只需要有个大致概念就行了，因为也不是专门去学习这套框架，我们只是需要使用这套框架的一丁点图片处理相关的东西而已。千言万语，最后就一句话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RenderScript 是 Android 上的高性能计算密集型任务的框架</span><br></pre></td></tr></table></figure>
<p>行，对 RenderScript 有了大致的了解后，可以开始了，官方文档里其实有比较详细的流程，先创建什么 context 啦，然后分配内存巴拉巴拉的拉，不过我这又不是在学RenderScript，而是想实现一个功能，用完就可以把这框架扔一边了，如果你也是这样，不妨直接 copy 下面的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 图片缩放比例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> BITMAP_SCALE = <span class="number">0.4f</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 最大模糊度(在0.0到25.0之间)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> BLUR_RADIUS = <span class="number">25f</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">blur</span><span class="params">(Context context, Bitmap image)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 计算图片缩小后的长宽</span></span><br><span class="line">    <span class="keyword">int</span> width = Math.round(image.getWidth() * BITMAP_SCALE);</span><br><span class="line">    <span class="keyword">int</span> height = Math.round(image.getHeight() * BITMAP_SCALE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将缩小后的图片作为预渲染的图片</span></span><br><span class="line">    Bitmap inputBitmap = Bitmap.createScaledBitmap(image, width, height, <span class="keyword">false</span>);</span><br><span class="line">    <span class="comment">// 创建一张渲染后的输出图片</span></span><br><span class="line">    Bitmap outputBitmap = Bitmap.createBitmap(inputBitmap);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化 RenderScript 上下文</span></span><br><span class="line">    RenderScript rs = RenderScript.create(context);</span><br><span class="line">    <span class="comment">// 创建一个模糊效果的 RenderScript 的工具对象</span></span><br><span class="line">    ScriptIntrinsicBlur blur = ScriptIntrinsicBlur.create(rs, Element.U8_4(rs));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 由于RenderScript并没有使用VM来分配内存,所以需要使用Allocation类来创建和分配内存空间。</span></span><br><span class="line">    <span class="comment">// 创建Allocation对象的时候其实内存是空的,需要使用copyTo()将数据填充进去。</span></span><br><span class="line">    Allocation tmpIn = Allocation.createFromBitmap(rs, inputBitmap);</span><br><span class="line">    Allocation tmpOut = Allocation.createFromBitmap(rs, outputBitmap);</span><br><span class="line">    <span class="comment">// 设置渲染的模糊程度, 25f是最大模糊度</span></span><br><span class="line">    blur.setRadius(BLUR_RADIUS);</span><br><span class="line">    <span class="comment">// 设置blurScript对象的输入内存</span></span><br><span class="line">    blur.setInput(tmpIn);</span><br><span class="line">    <span class="comment">// 将输出数据保存到输出内存中</span></span><br><span class="line">    blur.forEach(tmpOut);</span><br><span class="line">    <span class="comment">// 将数据填充到Allocation中</span></span><br><span class="line">    tmpOut.copyTo(outputBitmap);</span><br><span class="line">    <span class="keyword">return</span> outputBitmap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1976147-9bfb94c39bde175a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="renderscript.png"></p>
<h2 id="Java-amp-C"><a href="#Java-amp-C" class="headerlink" title="Java &amp; C++"></a>Java &amp; C++</h2><p>这两种都是采用同一种算法实现的，本质上都是对像素数组进行处理运算。本来我以为C++的方式会快一些，没想到在我的mix2上运行反而是Java实现的算法会快一些。唉，真是辣鸡C++还不如Java。 当然了……讲道理，代码我看了，就是一样的，可能是jni的开销吧。这里为什么要介绍Javah和C++的算法实现呢，因为RenderScript虽然文档上说可以运行在2.3及以上的平台，但是这个图片处理的api最低版本是17。所以说，如果你有需要兼容低版本，还是得采用下别的实现。</p>
<p>这里只放一下Java的实现代码，因为反而比较快的关系……至于JNI，我这里偷了个懒，因为以前用CMake项目编译生成了so，所以这里直接引用了so。当然了cpp源码也放在了项目里，感兴趣的可以自己去编译一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * StackBlur By Java Bitmap</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bmp    bmp Image</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> radius Blur radius</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Image Bitmap</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">blurInJava</span><span class="params">(Bitmap bmp, <span class="keyword">int</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Stack Blur v1.0 from</span></span><br><span class="line">        <span class="comment">// http://www.quasimondo.com/StackBlurForCanvas/StackBlurDemo.html</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// Java Author: Mario Klingemann &lt;mario at quasimondo.com&gt;</span></span><br><span class="line">        <span class="comment">// http://incubator.quasimondo.com</span></span><br><span class="line">        <span class="comment">// created Feburary 29, 2004</span></span><br><span class="line">        <span class="comment">// Android port : Yahel Bouaziz &lt;yahel at kayenko.com&gt;</span></span><br><span class="line">        <span class="comment">// http://www.kayenko.com</span></span><br><span class="line">        <span class="comment">// ported april 5th, 2012</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// This is a compromise between Gaussian Blur and Box blur</span></span><br><span class="line">        <span class="comment">// It creates much better looking blurs than Box Blur, but is</span></span><br><span class="line">        <span class="comment">// 7x faster than my Gaussian Blur implementation.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// I called it Stack Blur because this describes best how this</span></span><br><span class="line">        <span class="comment">// filter works internally: it creates a kind of moving stack</span></span><br><span class="line">        <span class="comment">// of colors whilst scanning through the image. Thereby it</span></span><br><span class="line">        <span class="comment">// just has to add one new block of color to the right side</span></span><br><span class="line">        <span class="comment">// of the stack and remove the leftmost color. The remaining</span></span><br><span class="line">        <span class="comment">// colors on the topmost layer of the stack are either added on</span></span><br><span class="line">        <span class="comment">// or reduced by one, depending on if they are on the right or</span></span><br><span class="line">        <span class="comment">// on the left side of the stack.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// If you are using this algorithm in your code please add</span></span><br><span class="line">        <span class="comment">// the following line:</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// Stack Blur Algorithm by Mario Klingemann &lt;mario@quasimondo.com&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (radius &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Bitmap bitmap = ratio(bmp, bmp.getWidth() * BITMAP_SCALE, bmp.getHeight() * BITMAP_SCALE);</span><br><span class="line"><span class="comment">//        Bitmap bitmap = bmp.copy(Bitmap.Config.ARGB_8888, true);</span></span><br><span class="line">        <span class="comment">// Return this none blur</span></span><br><span class="line">        <span class="keyword">if</span> (radius == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> bitmap;</span><br><span class="line">        &#125;</span><br><span class="line">        bmp.recycle();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> w = bitmap.getWidth();</span><br><span class="line">        <span class="keyword">int</span> h = bitmap.getHeight();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] pix = <span class="keyword">new</span> <span class="keyword">int</span>[w * h];</span><br><span class="line">        <span class="comment">// get array</span></span><br><span class="line">        bitmap.getPixels(pix, <span class="number">0</span>, w, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// run Blur</span></span><br><span class="line">        <span class="keyword">int</span> wm = w - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> hm = h - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> wh = w * h;</span><br><span class="line">        <span class="keyword">int</span> div = radius + radius + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">short</span> r[] = <span class="keyword">new</span> <span class="keyword">short</span>[wh];</span><br><span class="line">        <span class="keyword">short</span> g[] = <span class="keyword">new</span> <span class="keyword">short</span>[wh];</span><br><span class="line">        <span class="keyword">short</span> b[] = <span class="keyword">new</span> <span class="keyword">short</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> rSum, gSum, bSum, x, y, i, p, yp, yi, yw;</span><br><span class="line">        <span class="keyword">int</span> vMin[] = <span class="keyword">new</span> <span class="keyword">int</span>[Math.max(w, h)];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> divSum = (div + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        divSum *= divSum;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">short</span> dv[] = <span class="keyword">new</span> <span class="keyword">short</span>[<span class="number">256</span> * divSum];</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span> * divSum; i++) &#123;</span><br><span class="line">            dv[i] = (<span class="keyword">short</span>) (i / divSum);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        yw = yi = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[][] stack = <span class="keyword">new</span> <span class="keyword">int</span>[div][<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">int</span> stackPointer;</span><br><span class="line">        <span class="keyword">int</span> stackStart;</span><br><span class="line">        <span class="keyword">int</span>[] sir;</span><br><span class="line">        <span class="keyword">int</span> rbs;</span><br><span class="line">        <span class="keyword">int</span> r1 = radius + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> routSum, goutSum, boutSum;</span><br><span class="line">        <span class="keyword">int</span> rinSum, ginSum, binSum;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; h; y++) &#123;</span><br><span class="line">            rinSum = ginSum = binSum = routSum = goutSum = boutSum = rSum = gSum = bSum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i = -radius; i &lt;= radius; i++) &#123;</span><br><span class="line">                p = pix[yi + Math.min(wm, Math.max(i, <span class="number">0</span>))];</span><br><span class="line">                sir = stack[i + radius];</span><br><span class="line">                sir[<span class="number">0</span>] = (p &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">                sir[<span class="number">1</span>] = (p &amp; <span class="number">0x00ff00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                sir[<span class="number">2</span>] = (p &amp; <span class="number">0x0000ff</span>);</span><br><span class="line"></span><br><span class="line">                rbs = r1 - Math.abs(i);</span><br><span class="line">                rSum += sir[<span class="number">0</span>] * rbs;</span><br><span class="line">                gSum += sir[<span class="number">1</span>] * rbs;</span><br><span class="line">                bSum += sir[<span class="number">2</span>] * rbs;</span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    rinSum += sir[<span class="number">0</span>];</span><br><span class="line">                    ginSum += sir[<span class="number">1</span>];</span><br><span class="line">                    binSum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    routSum += sir[<span class="number">0</span>];</span><br><span class="line">                    goutSum += sir[<span class="number">1</span>];</span><br><span class="line">                    boutSum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            stackPointer = radius;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; w; x++) &#123;</span><br><span class="line"></span><br><span class="line">                r[yi] = dv[rSum];</span><br><span class="line">                g[yi] = dv[gSum];</span><br><span class="line">                b[yi] = dv[bSum];</span><br><span class="line"></span><br><span class="line">                rSum -= routSum;</span><br><span class="line">                gSum -= goutSum;</span><br><span class="line">                bSum -= boutSum;</span><br><span class="line"></span><br><span class="line">                stackStart = stackPointer - radius + div;</span><br><span class="line">                sir = stack[stackStart % div];</span><br><span class="line"></span><br><span class="line">                routSum -= sir[<span class="number">0</span>];</span><br><span class="line">                goutSum -= sir[<span class="number">1</span>];</span><br><span class="line">                boutSum -= sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (y == <span class="number">0</span>) &#123;</span><br><span class="line">                    vMin[x] = Math.min(x + radius + <span class="number">1</span>, wm);</span><br><span class="line">                &#125;</span><br><span class="line">                p = pix[yw + vMin[x]];</span><br><span class="line"></span><br><span class="line">                sir[<span class="number">0</span>] = (p &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">                sir[<span class="number">1</span>] = (p &amp; <span class="number">0x00ff00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                sir[<span class="number">2</span>] = (p &amp; <span class="number">0x0000ff</span>);</span><br><span class="line"></span><br><span class="line">                rinSum += sir[<span class="number">0</span>];</span><br><span class="line">                ginSum += sir[<span class="number">1</span>];</span><br><span class="line">                binSum += sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                rSum += rinSum;</span><br><span class="line">                gSum += ginSum;</span><br><span class="line">                bSum += binSum;</span><br><span class="line"></span><br><span class="line">                stackPointer = (stackPointer + <span class="number">1</span>) % div;</span><br><span class="line">                sir = stack[(stackPointer) % div];</span><br><span class="line"></span><br><span class="line">                routSum += sir[<span class="number">0</span>];</span><br><span class="line">                goutSum += sir[<span class="number">1</span>];</span><br><span class="line">                boutSum += sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                rinSum -= sir[<span class="number">0</span>];</span><br><span class="line">                ginSum -= sir[<span class="number">1</span>];</span><br><span class="line">                binSum -= sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                yi++;</span><br><span class="line">            &#125;</span><br><span class="line">            yw += w;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; w; x++) &#123;</span><br><span class="line">            rinSum = ginSum = binSum = routSum = goutSum = boutSum = rSum = gSum = bSum = <span class="number">0</span>;</span><br><span class="line">            yp = -radius * w;</span><br><span class="line">            <span class="keyword">for</span> (i = -radius; i &lt;= radius; i++) &#123;</span><br><span class="line">                yi = Math.max(<span class="number">0</span>, yp) + x;</span><br><span class="line"></span><br><span class="line">                sir = stack[i + radius];</span><br><span class="line"></span><br><span class="line">                sir[<span class="number">0</span>] = r[yi];</span><br><span class="line">                sir[<span class="number">1</span>] = g[yi];</span><br><span class="line">                sir[<span class="number">2</span>] = b[yi];</span><br><span class="line"></span><br><span class="line">                rbs = r1 - Math.abs(i);</span><br><span class="line"></span><br><span class="line">                rSum += r[yi] * rbs;</span><br><span class="line">                gSum += g[yi] * rbs;</span><br><span class="line">                bSum += b[yi] * rbs;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    rinSum += sir[<span class="number">0</span>];</span><br><span class="line">                    ginSum += sir[<span class="number">1</span>];</span><br><span class="line">                    binSum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    routSum += sir[<span class="number">0</span>];</span><br><span class="line">                    goutSum += sir[<span class="number">1</span>];</span><br><span class="line">                    boutSum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (i &lt; hm) &#123;</span><br><span class="line">                    yp += w;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            yi = x;</span><br><span class="line">            stackPointer = radius;</span><br><span class="line">            <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; h; y++) &#123;</span><br><span class="line">                <span class="comment">// Preserve alpha channel: ( 0xff000000 &amp; pix[yi] )</span></span><br><span class="line">                pix[yi] = (<span class="number">0xff000000</span> &amp; pix[yi]) | (dv[rSum] &lt;&lt; <span class="number">16</span>) | (dv[gSum] &lt;&lt; <span class="number">8</span>) | dv[bSum];</span><br><span class="line"></span><br><span class="line">                rSum -= routSum;</span><br><span class="line">                gSum -= goutSum;</span><br><span class="line">                bSum -= boutSum;</span><br><span class="line"></span><br><span class="line">                stackStart = stackPointer - radius + div;</span><br><span class="line">                sir = stack[stackStart % div];</span><br><span class="line"></span><br><span class="line">                routSum -= sir[<span class="number">0</span>];</span><br><span class="line">                goutSum -= sir[<span class="number">1</span>];</span><br><span class="line">                boutSum -= sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</span><br><span class="line">                    vMin[y] = Math.min(y + r1, hm) * w;</span><br><span class="line">                &#125;</span><br><span class="line">                p = x + vMin[y];</span><br><span class="line"></span><br><span class="line">                sir[<span class="number">0</span>] = r[p];</span><br><span class="line">                sir[<span class="number">1</span>] = g[p];</span><br><span class="line">                sir[<span class="number">2</span>] = b[p];</span><br><span class="line"></span><br><span class="line">                rinSum += sir[<span class="number">0</span>];</span><br><span class="line">                ginSum += sir[<span class="number">1</span>];</span><br><span class="line">                binSum += sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                rSum += rinSum;</span><br><span class="line">                gSum += ginSum;</span><br><span class="line">                bSum += binSum;</span><br><span class="line"></span><br><span class="line">                stackPointer = (stackPointer + <span class="number">1</span>) % div;</span><br><span class="line">                sir = stack[stackPointer];</span><br><span class="line"></span><br><span class="line">                routSum += sir[<span class="number">0</span>];</span><br><span class="line">                goutSum += sir[<span class="number">1</span>];</span><br><span class="line">                boutSum += sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                rinSum -= sir[<span class="number">0</span>];</span><br><span class="line">                ginSum -= sir[<span class="number">1</span>];</span><br><span class="line">                binSum -= sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                yi += w;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set Bitmap</span></span><br><span class="line">        bitmap.setPixels(pix, <span class="number">0</span>, w, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (bitmap);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://upload-images.jianshu.io/upload_images/1976147-22975722f452a427.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="动态模糊"><a href="#动态模糊" class="headerlink" title="动态模糊"></a>动态模糊</h2><p>这里实现的效果图就是开头的那张gif了，首先要明白一点，动态模糊，不可能每一帧都去调用方法生成一张模糊图，那样效率太低了。这里看了别人的思路，先生成一张模糊图片，之后在原来的布局上放上两个ImageView，一张原图，上面的一张是模糊图，动态改变上面模糊图的透明值就能实现动态透明效果。这想法阔以，只生成了一次模糊图片。</p>
<p>这里底部布局我本来是想放一个布局在屏幕外，后来发现这样无论怎么滑动都不能把布局滑入。可能是代码有问题，也可能是父容器的问题。于是之后就写了个全屏的布局，但是在界面启动后将之移动到屏幕外。设置了上下两块可点击将布局滑出的区域，在滑动的时候动态设置模糊图片控件的alpha值，这样就实现了动态模糊，话不多说，上关键代码：<br>布局代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/iv_img&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">&quot;@drawable/test&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:scaleType</span>=<span class="string">&quot;fitXY&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/iv_blur_img&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:scaleType</span>=<span class="string">&quot;fitXY&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:alpha</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/rl_container&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv_tem&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_margin</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:fontFamily</span>=<span class="string">&quot;sans-serif-thin&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;37°&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">&quot;90sp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;120dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;36dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;#44000000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">&quot;20dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;WeatherInfo&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">&quot;24sp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginBottom</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;Show more info&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">&quot;@android:color/white&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;120dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;36dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;#44000000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">&quot;20dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;WeatherInfo&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">&quot;24sp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginBottom</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;Show more info&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">&quot;@android:color/white&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;120dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;36dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;#44000000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">&quot;20dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;WeatherInfo&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">&quot;@android:color/white&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">&quot;24sp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginBottom</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;Show more info&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">&quot;@android:color/white&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Activity代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiasuhuei321.blur;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.Window;</span><br><span class="line"><span class="keyword">import</span> android.view.WindowManager;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiasuhuei321.gank_kotlin.ImageProcess;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by xiasuhuei321 on 2017/10/15.</span></span><br><span class="line"><span class="comment"> * author:luo</span></span><br><span class="line"><span class="comment"> * e-mail:xiasuhuei321@163.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicBlurActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ImageView blurImg;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line">    <span class="keyword">private</span> View container;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        supportRequestWindowFeature(Window.FEATURE_NO_TITLE);</span><br><span class="line">        <span class="keyword">int</span> flag = WindowManager.LayoutParams.FLAG_FULLSCREEN;</span><br><span class="line">        <span class="comment">//获得当前窗体对象</span></span><br><span class="line">        Window window = <span class="keyword">this</span>.getWindow();</span><br><span class="line">        <span class="comment">//设置当前窗体为全屏显示</span></span><br><span class="line">        window.setFlags(flag, flag);</span><br><span class="line">        setContentView(R.layout.activity_dynamic_blur);</span><br><span class="line">        initView();</span><br><span class="line">        WindowManager wm = (WindowManager) getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">        height = wm.getDefaultDisplay().getHeight();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        blurImg = (ImageView) findViewById(R.id.iv_blur_img);</span><br><span class="line">        blurImg.setImageBitmap(ImageProcess.blur(<span class="keyword">this</span>,</span><br><span class="line">                BitmapFactory.decodeResource(getResources(), R.drawable.test)));</span><br><span class="line">        container = findViewById(R.id.rl_container);</span><br><span class="line">        <span class="keyword">new</span> Handler().postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                container.setTranslationY(height + <span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> y;</span><br><span class="line">    <span class="keyword">boolean</span> scrollFlag = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">float</span> sumY = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">boolean</span> isShow = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                y = event.getY();</span><br><span class="line">                <span class="keyword">if</span> (y &gt; height * <span class="number">0.9</span>) &#123;</span><br><span class="line">                    scrollFlag = <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (y &lt; height * <span class="number">0.1</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!isShow) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    scrollFlag = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                sumY = event.getY() - y;</span><br><span class="line">                <span class="keyword">if</span> (scrollFlag) &#123;</span><br><span class="line">                    container.setTranslationY(event.getY());</span><br><span class="line">                    <span class="keyword">if</span> (!isShow) blur(sumY);</span><br><span class="line">                    <span class="keyword">else</span> reverseBlur(sumY);</span><br><span class="line">                &#125;</span><br><span class="line">                Log.e(<span class="string">&quot;DynamicBlurActivity&quot;</span>, <span class="string">&quot;滚动sumY值：&quot;</span> + sumY + <span class="string">&quot; scrollFlag：&quot;</span> + scrollFlag);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                <span class="keyword">if</span>(scrollFlag) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (Math.abs(sumY) &gt; height * <span class="number">0.5</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (isShow) hide();</span><br><span class="line">                        <span class="keyword">else</span> show();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (isShow) show();</span><br><span class="line">                        <span class="keyword">else</span> hide();</span><br><span class="line">                    &#125;</span><br><span class="line">                    sumY = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                scrollFlag = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hide</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        container.setTranslationY(height + <span class="number">100</span>);</span><br><span class="line">        blur(<span class="number">0</span>);</span><br><span class="line">        isShow = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        container.setTranslationY(<span class="number">0</span>);</span><br><span class="line">        blur(<span class="number">1000</span>);</span><br><span class="line">        isShow = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">blur</span><span class="params">(<span class="keyword">float</span> sumY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> absSum = Math.abs(sumY);</span><br><span class="line">        <span class="keyword">float</span> alpha = absSum / <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">if</span> (alpha &gt; <span class="number">1</span>) alpha = <span class="number">1</span>;</span><br><span class="line">        blurImg.setAlpha(alpha);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">reverseBlur</span><span class="params">(<span class="keyword">float</span> sumY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> absSum = Math.abs(sumY);</span><br><span class="line">        <span class="keyword">float</span> alpha = absSum / <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">if</span> (alpha &gt; <span class="number">1</span>) alpha = <span class="number">1</span>;</span><br><span class="line">        blurImg.setAlpha(<span class="number">1</span> - alpha);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在刚开始的时候我非常的作死，选用的图片是1080 * 1920 的，在处理的时候一看内存，我 * 飙到了200多M，而且处理这张图片花费了6.6秒左右的时间。我打印了一下这图片转化成Bitmap的width和height 分别是</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1976147-02ea7e2396c60508.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="长宽"></p>
<p>这如果是 ARGB_8888 那么一张图就是61M，加上处理需要一个像素数组，得，另一个61M。剩下在处理像素的时候各种申请的内存飙到200M也不是不可以理解。本来我想是不是可以使用同一张 Bitmap，在最后setPixels的时候就不用再申请一次内存了，但是发现这样不行，直接报错了。因为从资源文件拿到的 Bitmap 的 isMutable属性是false，不可以直接在原来的 Bitmap 上 setPixels 。所以原来还需要拷贝一份Bitmap，不过拷贝之后可以将调用 bitmap.recycle() 方法，将之赶紧回收了。</p>
<p>当然，像我这样头铁硬怼并不好，飙到200M市面上很多手机都会OOM……更好的方式是对缩略图进行模糊处理。Android里有个缩略图工具，就几个方法，还挺好用的，我这里就用的缩略图工具获取缩略图：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">ratio</span><span class="params">(Bitmap bmp, <span class="keyword">float</span> pixelW, <span class="keyword">float</span> pixelH)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ThumbnailUtils.extractThumbnail(bmp, (<span class="keyword">int</span>) pixelW, (<span class="keyword">int</span>) pixelH);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在进行处理前先获取缩略图，然后再去处理效率无疑会高非常多。</p>
<p>最后，放上项目地址：<a target="_blank" rel="noopener" href="https://github.com/ForgetAll/Blur">https://github.com/ForgetAll/Blur</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/JNI/" rel="tag"># JNI</a>
              <a href="/tags/%E7%AE%97%E6%B3%95/" rel="tag"># 算法</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/10/16/Android%206.0%20%E5%8A%A8%E6%80%81%E6%9D%83%E9%99%90%E7%94%B3%E8%AF%B7%E4%B8%8E%207.0%20%E9%80%82%E9%85%8D%20File%20Uri%20%E5%B0%8F%E8%AE%B0/" rel="prev" title="Android 6.0 动态权限申请与 7.0 适配 File Uri 小记">
      <i class="fa fa-chevron-left"></i> Android 6.0 动态权限申请与 7.0 适配 File Uri 小记
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/10/25/Python%E5%85%A5%E6%89%8B%EF%BC%88%E4%B8%80%EF%BC%89/" rel="next" title="Python入手（一）">
      Python入手（一） <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RenderScript"><span class="nav-number">2.</span> <span class="nav-text">RenderScript</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-amp-C"><span class="nav-number">3.</span> <span class="nav-text">Java &amp; C++</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%A8%A1%E7%B3%8A"><span class="nav-number">4.</span> <span class="nav-text">动态模糊</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="LJ"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">LJ</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ForgetAll" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ForgetAll" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://blankj.com/" title="https:&#x2F;&#x2F;blankj.com&#x2F;" rel="noopener" target="_blank">blankj-开源达人</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LJ</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
